# ggpaintr

An open-source R package for building modularized shiny apps with
plotting functionalities using `ggplot2` and the Grammar of Graphics

## Installation

You can install the development version from Github with:

``` r
# install.packages("devtools")
devtools::install_github("willju-wangqian/ggpaintr")
```

## Building a shiny app that can make plots with `ggplot2`

![Some Caption](reference/figures/ggpaintr_iris_1.png)

Some Caption

This figure shows a shiny app that can make plots with `ggplot2`. After
selecting a dataset, the shiny app allows users to map variables (or
columns) in the dataset to `x` and `y`. It generates a plot using
`ggplot2` and shows the corresponding `R` code. The reactivity on the
mappings are built up so that changing mappings variables for `x` or `y`
will change the resulting plot after clicking the “draw” button.
Moreover, changing the selected dataset will automatically update the
available choices for `x` and `y`. Without the help of `ggpaintr`,
building such a shiny app at least requires the following steps:

- have UI components for `x` and `y` so that `input$x` and `input$y` are
  available
- dynamically render UI components for `x` and `y` so that the available
  choices depend on the selected data set
- figure out how to generate a `ggplot2` plot using `input$x` and
  `input$y` since the inputs are strings. One option is to use
  [`aes_string()`](https://ggplot2.tidyverse.org/reference/aes_.html)
- figure out the `R` code for generating the resulting plot
- render the plot
- render the code

This might look involved, but what if this shiny app needs more
functionalities? If the shiny app needs more mappings, such as `color`
or `fill`, it will add more UI component, modify the server part so that
the inputs can be correctly captured. If the shiny app wants to allow
users to flip the coordinates using
[`coord_flip()`](https://ggplot2.tidyverse.org/reference/coord_flip.html)
or adding labels using
[`labs()`](https://ggplot2.tidyverse.org/reference/labs.html), building
this shiny app becomes even more involved. Additionally, maintaining and
updating the shiny app can be challenging as well since many aspects of
the shiny app would be modified.

However, we can build such a shiny app using `ggpaintr` with the
following code.

``` r
library(ggpaintr)
library(shiny)
library(tidyverse)
library(shinyWidgets)
library(palmerpenguins)

# Define UI for application that draws a histogram
ui <- fluidPage(
  
  # Application title
  titlePanel("ggpaintr demo"),
  
  # Sidebar with a slider input for number of bins
  sidebarLayout(
    sidebarPanel(
      pickerInput("defaultData", "select a default dataset:",
                  choices = c("iris", "mtcars","penguins", "faithfuld"),
                  selected = "",
                  multiple = TRUE,
                  options = pickerOptions(maxOptions = 1)),
      uiOutput("controlPanel"),
      actionButton("draw", "click to draw the plot"),
    ),
    
    # Show a plot of the generated distribution
    mainPanel(
      plotOutput("outputPlot"),
      verbatimTextOutput('outputCode')
    )
  )
)

# Define server logic required to draw a histogram
server <- function(input, output) {
  
  control_id <- "control_id"
  
  # data
  data_container <- reactive({
    req(input$defaultData)
    get(input$defaultData)
  })
  
  # construct paintr object
  paintr_rctv <- reactive({
    
    req(data_container())
    
    paintr(control_id,
           data_container(), data_path = input$defaultData,
           geom_boxplot(aes(x, y)) 
    )
    
  })
  
  # place ui
  output$controlPanel <- renderUI({
    req(paintr_rctv())
    
    column(
      12,
      paintr_get_ui(paintr_rctv(), "x"),
      paintr_get_ui(paintr_rctv(), "y"),
    )
  })
  
  # take results and plot
  observe({
    req(paintr_rctv(), data_container(), input$defaultData)
    data <- data_container()
    
    paintr_results <- paintr_plot_code(paintr_rctv())
    
    # Plot output
    output$outputPlot <- renderPlot({
      
      paintr_results[['plot']]
      
    })
    
    # Code output
    output$outputCode <- renderText({
      
      paintr_results[['code']]
      
    })
    
  }) %>% bindEvent(input$draw)
  
  
}

# Run the application
shinyApp(ui = ui, server = server)
```

Many things are hidden and handled by functions in `ggpaintr`. And
updating this shiny app can be relatively easy with the help of
`ggpaintr`: by changing the `ggplot2` alike expression at line 51 into

``` r
# add mapping for fill
geom_boxplot(aes(x, y, fill)) +
  coord_flip +        # allow users to flip coordinate
  labs(x, y, title)   # allow users to add labels for x-axis, y-axis, and title
```

and adding more elements in `output$controlPanel <- renderUI()` at line
57:

``` r
# place ui
output$controlPanel <- renderUI({
  req(paintr_rctv())
  
  column(
    12,
    paintr_get_ui(paintr_rctv(), "x"),
    paintr_get_ui(paintr_rctv(), "y"),
    paintr_get_ui(paintr_rctv(), "fill"),
    paintr_get_ui(paintr_rctv(), "coord_flip"), # add UI for coord_flip()
    paintr_get_ui(paintr_rctv(), "labs"),       # add UI for labs()
  )
})
```

we can build a shiny app with the updated features as shown in Figure X.
We can see that the shiny app now allows users to flip coordinates and
set labels. The plot and corresponding `R` code can be updated
accordingly as well.

![Some Caption](reference/figures/ggpaintr_iris_2.png)

Some Caption

## Building a shiny app using `ggpaintr`

A shiny app called `ggpaintr_app` is built with the `ggpaintr` package
and included in the package. `ggpaintr_app` not only demonstrates the
functionality of `ggpaintr`, but also serves as a shiny app for those
unfamiliar with the Grammar of Graphics or ggplot2 but want to create a
plot using ggplot2. Some design of `ggpaintr_app` can also provide
reference for package/shiny app developers. To start the app:

``` r
library(ggpaintr)

run_ggpaintr_app()
```

## Development

- location for external data: `inst/extdata`
- location for example shiny app: `inst/shiny`
- location for files that need to be uploaded but are not part of the
  package: `preconsideration/<folder_name>`
- coding style consistency: please try to use
  `underscores_in_variable_names` and (maybe) `camelCase` for
  web-related names…

## Generate plot icons

- the code that generates the plot icons:
  `preconsideration/generate_plot_icon`
- we can save the generated icons into
  `preconsideration/saved_plot_icon` or copy them to
  `inst/shiny/ggpaintr_app/www/img_button`
- different functions for `actionButton`
  - [`shinyWidgets::actionBttn`](https://dreamrs.github.io/shinyWidgets/reference/actionBttn.html),
    [link](https://bttn.surge.sh/)
  - `actionButton`: this is the default and we can specify the `style`
    attribute
  - `bsButton`: this includes both the `actionButton` and
    `checkboxInput`, but we don’t have much room for `style`

## Future work

- extensibility +

## Change log

#### version number: 0.0.9.8

- fixed `DT` filtering problem in `ggpaintr_app`

- Todo: ???

#### version number: 0.0.9.7

- fixed code for numeric input

- allow categorical variables to have less than 3 levels

- Todo - `ggpaintr_app`:

  - filters from `DT` will invalidate the code

#### version number: 0.0.9.6

- alpha as numeric

- n \< 3 colors

- added four chart types, next: update functions in the package

- change expression by clicking the plot icon

- test if ui functions can be added

- how to add customized handler functions?

#### version number: 0.0.9.5

- Updates:
  - introduced `paintr_obj` and
    [`paintr()`](https://willju-wangqian.github.io/ggpaintr/reference/paintr.md),
    which use a grammar similar to `ggplot2` to specify and control all
    elements or pieces built in the shiny app
  - use one function to build reactivity of `color` or `fill` so that
    they can work with `paintr_plot_code`
- TODO:
  - documentations and dependencies
  - write-ups
  - download plot
  - test and finalize code then push to main

#### version number: 0.0.9.4

heuristics:

- parameters of handlers
- parameters of ui modules
- returns of handlers

TODO:

documentations

icon position or size

writeup

- the concept of grammar of graphics
- why this package can be useful
- how to use the package

how to wrap up the part of scale_color

template?

download plot

aes then comma

#### version number: 0.0.9.3

- updates:
  - the app is now able to show code that generates the plot
  - dynamic color picker
- TODO:
  - update ui
  - implement other plot types
  - extend the current functionality: added more handlers (for example
    one for
    [`labs()`](https://ggplot2.tidyverse.org/reference/labs.html))
  - documentations

#### version number: 0.0.9.2

- updates:
  - `*Handler`s are introduced for plot generation
  - added bar chart

#### version number: 0.0.9.1

- updates:
  - new ui
  - example for box plot finished
- TODO:
  - update the geomGenerators
    - each line of Grammar of Graphics has its onw handler
    - a function that collects all handlers
    - find a way to connect handlers to its ui components
  - allow color pickers to respond to the selected variable
  - update ui
  - implement other plot types
  - display code

# Package index

## All functions

- [`addDefaultArgs()`](https://willju-wangqian.github.io/ggpaintr/reference/addDefaultArgs.md)
  : Add one element into a list of arguments

- [`append_list_name()`](https://willju-wangqian.github.io/ggpaintr/reference/append_list_name.md)
  : Append a named list

- [`argsAlphaUI()`](https://willju-wangqian.github.io/ggpaintr/reference/argsAlphaUI.md)
  :

  ui component for setting `alpha` in `geom_<chart>`

- [`argsPositionUI()`](https://willju-wangqian.github.io/ggpaintr/reference/argsPositionUI.md)
  :

  ui component for setting `position` in `geom_<chart>`

- [`argsSizeUI()`](https://willju-wangqian.github.io/ggpaintr/reference/argsSizeUI.md)
  :

  ui component for setting `size` in `geom_<chart>`

- [`argsStatUI()`](https://willju-wangqian.github.io/ggpaintr/reference/argsStatUI.md)
  :

  ui component for setting `stat` in `geom_<chart>`

- [`callFuncUI()`](https://willju-wangqian.github.io/ggpaintr/reference/callFuncUI.md)
  : Calls the selected ui functions by the name of the key

- [`check_char_set_names()`](https://willju-wangqian.github.io/ggpaintr/reference/check_char_set_names.md)
  : Check if a character vector has name

- [`check_remove_null()`](https://willju-wangqian.github.io/ggpaintr/reference/check_remove_null.md)
  :

  check if a list has `NULL`; if so, remove it (them)

- [`connect_param_id()`](https://willju-wangqian.github.io/ggpaintr/reference/connect_param_id.md)
  : Connect parameters to their input obtained from the ui elements by
  their ids

- [`controlUI()`](https://willju-wangqian.github.io/ggpaintr/reference/controlUI.md)
  : get all ui elements

- [`facetHandler()`](https://willju-wangqian.github.io/ggpaintr/reference/facetHandler.md)
  :

  Module server for
  [`facet_grid()`](https://ggplot2.tidyverse.org/reference/facet_grid.html)

- [`flipHandler()`](https://willju-wangqian.github.io/ggpaintr/reference/flipHandler.md)
  :

  Module server for
  [`coord_flip()`](https://ggplot2.tidyverse.org/reference/coord_flip.html)

- [`getControlList()`](https://willju-wangqian.github.io/ggpaintr/reference/getControlList.md)
  : Get all the implemented keys and their corresponding ui functions or
  handler functions

- [`get_code()`](https://willju-wangqian.github.io/ggpaintr/reference/get_code.md)
  : Extract code

- [`get_filter()`](https://willju-wangqian.github.io/ggpaintr/reference/get_filter.md)
  : Extract filtering code

- [`get_plot()`](https://willju-wangqian.github.io/ggpaintr/reference/get_plot.md)
  : Extract plot

- [`get_plot_code()`](https://willju-wangqian.github.io/ggpaintr/reference/get_plot_code.md)
  : Extract code and plot

- [`ggGeomHandler()`](https://willju-wangqian.github.io/ggpaintr/reference/ggGeomHandler.md)
  :

  Generate the geom component of a `ggplot2` plot

- [`labsHandler()`](https://willju-wangqian.github.io/ggpaintr/reference/labsHandler.md)
  :

  Module server for
  [`labs()`](https://ggplot2.tidyverse.org/reference/labs.html)

- [`labsUI()`](https://willju-wangqian.github.io/ggpaintr/reference/labsUI.md)
  :

  ui component for
  [`labs()`](https://ggplot2.tidyverse.org/reference/labs.html)

- [`mappingColorUI()`](https://willju-wangqian.github.io/ggpaintr/reference/mappingColorUI.md)
  : UI component and its id for aesthetic mapping of color

- [`mappingFillUI()`](https://willju-wangqian.github.io/ggpaintr/reference/mappingFillUI.md)
  : UI component and its id for aesthetic mapping of fill

- [`mappingGroupUI()`](https://willju-wangqian.github.io/ggpaintr/reference/mappingGroupUI.md)
  : UI component and its id for aesthetic mapping of group

- [`mappingShapeUI()`](https://willju-wangqian.github.io/ggpaintr/reference/mappingShapeUI.md)
  : UI component and its id for aesthetic mapping of shape

- [`mappingSizeUI()`](https://willju-wangqian.github.io/ggpaintr/reference/mappingSizeUI.md)
  : UI component and its id for aesthetic mapping of size

- [`mappingXUI()`](https://willju-wangqian.github.io/ggpaintr/reference/mappingXUI.md)
  : UI component and its id for aesthetic mapping of x

- [`mappingYUI()`](https://willju-wangqian.github.io/ggpaintr/reference/mappingYUI.md)
  : UI component and its id for aesthetic mapping of y

- [`mappingZUI()`](https://willju-wangqian.github.io/ggpaintr/reference/mappingZUI.md)
  : UI component and its id for aesthetic mapping of z

- [`matchControls()`](https://willju-wangqian.github.io/ggpaintr/reference/matchControls.md)
  : match key to its ui or handler function

- [`multipleColorPickerUI()`](https://willju-wangqian.github.io/ggpaintr/reference/multipleColorPickerUI.md)
  :

  ui component for setting `colourInput`

- [`paintr()`](https://willju-wangqian.github.io/ggpaintr/reference/paintr.md)
  :

  Construct a `paintr_obj` based on an expression in `ggplot2` alike
  layout

- [`paintr_geom_construct()`](https://willju-wangqian.github.io/ggpaintr/reference/paintr_geom_construct.md)
  : Deconstruct the paintr expression

- [`paintr_get_ui()`](https://willju-wangqian.github.io/ggpaintr/reference/paintr_get_ui.md)
  :

  Get a ui element or its id of a paintr keyword from a `paintr_obj`

- [`paintr_plot_code()`](https://willju-wangqian.github.io/ggpaintr/reference/paintr_plot_code.md)
  :

  Generate plot and the corresponding code of `ggplot2` from a
  `paintr_obj`

- [`paste_arg_param()`](https://willju-wangqian.github.io/ggpaintr/reference/paste_arg_param.md)
  : Paste parameter and its argument

- [`run_ggpaintr_app()`](https://willju-wangqian.github.io/ggpaintr/reference/run_ggpaintr_app.md)
  : Call ggpaintr_app

- [`scaleColorFillHandler()`](https://willju-wangqian.github.io/ggpaintr/reference/scaleColorFillHandler.md)
  :

  Module server that sets colors through `scale_fill_gradient`,
  `scale_fill_manual`, `scale_color_gradient`, `scale_color_manual`

- [`scaleColorHandler_inner()`](https://willju-wangqian.github.io/ggpaintr/reference/scaleColorHandler_inner.md)
  :

  The inner module server that sets colors through
  `scale_fill_gradient`, `scale_fill_manual`, `scale_color_gradient`,
  `scale_color_manual`

- [`scaleColorUI()`](https://willju-wangqian.github.io/ggpaintr/reference/scaleColorUI.md)
  : ui component for scale color

- [`scaleColor_build_reactivity()`](https://willju-wangqian.github.io/ggpaintr/reference/scaleColor_build_reactivity.md)
  :

  Build reactivity for `scale_color` or `scale_fill`

- [`scaleFillUI()`](https://willju-wangqian.github.io/ggpaintr/reference/scaleFillUI.md)
  : ui component for scale fill

- [`settingFacetUI()`](https://willju-wangqian.github.io/ggpaintr/reference/settingFacetUI.md)
  :

  ui component for selecting variables for
  [`facet_grid()`](https://ggplot2.tidyverse.org/reference/facet_grid.html)

- [`settingFlipUI()`](https://willju-wangqian.github.io/ggpaintr/reference/settingFlipUI.md)
  :

  ui component for deciding whether or not to toggle
  [`coord_flip()`](https://ggplot2.tidyverse.org/reference/coord_flip.html)

- [`stringParamHandler()`](https://willju-wangqian.github.io/ggpaintr/reference/stringParamHandler.md)
  :

  Module server for a `ggplot2` function which takes strings as
  arguments

- [`themeChooseHandler()`](https://willju-wangqian.github.io/ggpaintr/reference/themeChooseHandler.md)
  :

  Module server that provides several `ggplot2` themes

- [`themeChooseUI()`](https://willju-wangqian.github.io/ggpaintr/reference/themeChooseUI.md)
  : ui component for choosing themes

- [`themeHandler()`](https://willju-wangqian.github.io/ggpaintr/reference/themeHandler.md)
  :

  Module server for
  [`theme()`](https://ggplot2.tidyverse.org/reference/theme.html)

- [`themeUI()`](https://willju-wangqian.github.io/ggpaintr/reference/themeUI.md)
  :

  ui component for
  [`theme()`](https://ggplot2.tidyverse.org/reference/theme.html)

- [`unwrap_expr()`](https://willju-wangqian.github.io/ggpaintr/reference/unwrap_expr.md)
  : Unwrap an expression

# Articles

### All vignettes

- [Introduction to
  ggpaintr](https://willju-wangqian.github.io/ggpaintr/articles/intro-ggpaintr.md):
